{% extends "index.html" %}

{% block title %}Compare Layers{% endblock title %}

{% block main_nav_links %}
    
    <h2>Compare Tool Interface</h2>
    <p>Please select the two layers you wish to compare:</p>
    
    <form method="POST" action="/run_compare" enctype="multipart/form-data" id="compare-form" onsubmit="showLoading()">
        
        {# Layer 1 Input #}
        <fieldset style="margin-bottom: 20px; padding: 15px; border: 1px solid #ccc;">
            <legend><strong>Layer 1</strong></legend>
            
            <div style="margin-bottom: 10px;">
                <label for="file_select_1">Select from Available Files:</label>
                <select id="file_select_1" name="file_path_1" style="width: 100%; max-width: 600px;">
                    <option value="">-- Select a file --</option>
                    {% for file in available_files %}
                        <option value="{{ file }}">{{ file }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div style="margin-top: 10px; margin-left: 20px;">
                <em>OR upload your own file:</em><br>
                <input type="file" id="filePicker1" name="user_file1" accept=".tif,.tiff"> 
                <span id="fileName1" class="file-name-display"></span>
            </div>
        </fieldset>
        
        {# Layer 2 Input #}
        <fieldset style="margin-bottom: 20px; padding: 15px; border: 1px solid #ccc;">
            <legend><strong>Layer 2</strong></legend>
            
            <div style="margin-bottom: 10px;">
                <label for="file_select_2">Select from Available Files:</label>
                <select id="file_select_2" name="file_path_2" style="width: 100%; max-width: 600px;">
                    <option value="">-- Select a file --</option>
                    {% for file in available_files %}
                        <option value="{{ file }}">{{ file }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div style="margin-top: 10px; margin-left: 20px;">
                <em>OR upload your own file:</em><br>
                <input type="file" id="filePicker2" name="user_file2" accept=".tif,.tiff">
                <span id="fileName2" class="file-name-display"></span>
            </div>
        </fieldset>
        
        <button type="submit" style="padding: 10px 20px; font-size: 16px;">Compare Layers</button>
        
    </form>
    
    <script>
        // ADD THIS FUNCTION
        function showLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.style.display = 'flex';
            }
        }

        // Display filename when file is selected
        document.getElementById('filePicker1').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name || 'No file selected';
            document.getElementById('fileName1').textContent = fileName;
            if (e.target.files[0]) {
                document.getElementById('file_select_1').value = ''; // Clear dropdown
            }
        });
        
        document.getElementById('filePicker2').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name || 'No file selected';
            document.getElementById('fileName2').textContent = fileName;
            if (e.target.files[0]) {
                document.getElementById('file_select_2').value = ''; // Clear dropdown
            }
        });
        
        // Clear file upload when dropdown is selected
        document.getElementById('file_select_1').addEventListener('change', function(e) {
            if (e.target.value) {
                document.getElementById('filePicker1').value = '';
                document.getElementById('fileName1').textContent = '';
            }
        });
        
        document.getElementById('file_select_2').addEventListener('change', function(e) {
            if (e.target.value) {
                document.getElementById('filePicker2').value = '';
                document.getElementById('fileName2').textContent = '';
            }
        });
    </script>
    
{% endblock main_nav_links %}